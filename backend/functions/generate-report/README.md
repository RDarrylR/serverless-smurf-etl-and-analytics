# Generate Report Lambda Function

## Purpose

Generates a formatted plain-text daily sales report for SNS email notification. Combines company metrics, top products, and AI insights into a human-readable format.

## Handler

`lambda_function.lambda_handler`

## Runtime

- **Python:** 3.13
- **Architecture:** arm64 (Graviton2)

## Configuration

- **Timeout:** 30 seconds
- **Memory:** 1024 MB

## Input

```json
{
  "date": "2025-01-15",
  "company_metrics": {
    "total_sales": 12345.67,
    "total_transactions": 450,
    "total_items": 1320,
    "avg_transaction": 27.43,
    "store_count": 11,
    "best_store": {"store_id": "0003", "total_sales": 2500.00},
    "worst_store": {"store_id": "0007", "total_sales": 800.00},
    "payment_breakdown": {...}
  },
  "product_metrics": [...],
  "insights": {
    "anomalies": [...],
    "trends": [...],
    "recommendations": [...]
  }
}
```

## Output

```json
{
  "date": "2025-01-15",
  "subject": "Daily Sales Report - 2025-01-15",
  "message": "SMURF MEMORABILIA DAILY SALES REPORT\n========================================\n..."
}
```

## Report Sections

1. **Company Summary** - Total sales, transactions, items, store count
2. **Best/Worst Stores** - Top and bottom performing stores
3. **Payment Breakdown** - Sales by payment method
4. **Top Products** - Top 5 selling products
5. **AI Insights** - Anomalies, trends, and recommendations (if available)

## Report Format

```
SMURF MEMORABILIA DAILY SALES REPORT
========================================
Date: 2025-01-15

COMPANY SUMMARY
----------------------------------------
Total Sales: $12,345.67
Transactions: 450
Total Items: 1,320
Stores Reporting: 11/11
Avg Transaction: $27.43

Best Store: #0003 ($2,500.00)
Worst Store: #0007 ($800.00)

PAYMENT BREAKDOWN
----------------------------------------
  Credit: $6,000.00
  Cash: $3,500.00
  Debit: $2,000.00
  Gift Card: $845.67

TOP PRODUCTS
----------------------------------------
1. Papa Smurf Figurine - 150 units - $2,998.50
2. Smurfette Plush - 120 units - $1,799.40
...

AI INSIGHTS (Powered by Amazon Bedrock)
========================================

ANOMALIES DETECTED
----------------------------------------
[!] Store 0007 sales below average
   Sales are 35% below the 7-day average...

TRENDS IDENTIFIED
----------------------------------------
-> Credit card adoption increasing
   Week-over-week increase of 15%...

RECOMMENDATIONS
----------------------------------------
1. [HIGH] Investigate Store 0007 performance
   Review staffing and inventory levels...

----------------------------------------
Report generated by Sales Data Platform
```

## Dependencies

- `boto3` (included in Lambda runtime)
- `aws-lambda-powertools` (via Lambda Layer)

## Building

```bash
./build.sh
```

This creates `generate-report.zip` in the functions directory.

## Severity Icons

| Icon | Severity |
|------|----------|
| `[!!!]` | Critical |
| `[!]` | Warning |
| `[i]` | Info |

## Priority Icons

| Icon | Priority |
|------|----------|
| `[HIGH]` | High priority |
| `[MED]` | Medium priority |
| `[LOW]` | Low priority |
